
{{/* Stats dictionnaire */}}

{{$perso := sdict}}
{{with (dbGet 0 "Personnage" )}}
	{{$perso = sdict .Value}}
{{end}}

{{$user := .User.Nick}}
{{if eq (len $user) 0}}
	{{$user = .User.Username}}
{{end}}
{{$idR := .User.ID}}
{{$id := .User.ID}}

{{if .CmdArgs}}
	{{if eq (index .CmdArgs 0) "-new"}}
		{{$user = (index .CmdArgs 1) }}
		{{if (reFind `(\>\S*)` $user)}}
			{{$user = (reReplace ">" $user "")}}
			{{$idp := toRune (lower $user)}}
			{{with (reFind `<@!?\d{17,}>` .Message.Content)}}
				{{$id = .}}
				{{$id = $id.ID}}
			{{end}}
			{{$idR = $id}}
			{{range $idp}}
				{{- $id = add $id .}}
			{{- end}}
		{{else if (reFind `<@!?\d{17,}>` $user)}}
			{{$user = userArg $user}}
			{{$id = $user.ID}}
			{{$idR = $id}}
			{{$user = (getMember $id).Nick}}
			{{if eq (len $user) 0}}
				{{$user = $user.Username}}
			{{end}}
		{{end}}
		{{$user = title $user}}
		{{$perso.Set $user (sdict "Personnage" $user "ID" $id "IDR" $idR "shop" "n")}}
		{{print $user "a bien été rajouté à la base de donnée !"}}
		{{dbSet 0 "Personnage" $perso}}
	{{else if eq (index .CmdArgs 0) "-rm"}}
		{{$user = (index .CmdArgs 1) }}
		{{if (reFind `(\>\S*)` $user)}}
			{{$user = title (reReplace ">" $user "")}}
			{{$idp := toRune (lower $user)}}
			{{with ($perso.Get $user)}}
				{{$id = .IDR}}
			{{end}}
			{{$idR = $id}}
			{{range $idp}}
				{{- $id = add $id .}}
			{{- end}}
		{{else if (reFind `<@!?\d{17,}>` $user)}}
			{{$user = userArg $user}}
			{{$user = (getMember $id).Nick}}
			{{if eq (len $user) 0}}
				{{$user = $user.Username}}
			{{end}}
			{{$perso.Del $user}}
			{{print $user " a bien été supprimé de la DB."}}
			{{dbSet 0 "Personnage" $perso}}
		{{end}}
	{{else if eq (index .CmdArgs 0) "-rename"}}
		{{$user = (index .CmdArgs 1) }}
		{{if (reFind `(\>\S*)` $user)}}
			{{$user = title (reReplace ">" $user "")}}
			{{$idp := toRune (lower $user)}}
			{{with ($perso.Get $user)}}
				{{$id = .IDR}}
			{{end}}
			{{$idR = $id}}
			{{range $idp}}
				{{- $id = add $id .}}
			{{- end}}
		{{else if (reFind `<@!?\d{17,}>` $user)}}
			{{$user = userArg $user}}
			{{$user = (getMember $id).Nick}}
			{{if eq (len $user) 0}}
				{{$user = $user.Username}}
			{{end}}
		{{end}}
		{{$pg := sdict}}
		{{with ($perso.Get $user)}}
			{{$pg = sdict .}}
		{{end}}
		{{$name = (index .CmdArgs 2)}}
		{{$pg.Set "Personnage" $name}}
		{{$perso.Set $pg}}
		{{dbSet 0 "Personnage" $perso}}
	{{else}}
		{{print "Usage : \n `$set (-new|rm|rename) >@cible \n Pour un new avec un reroll, il faut absolument mentionner le joueur du Reroll !! "}}
	{{end}}
{{else}}
	{{print "Usage : \n `$set (-new|rm|rename) >@cible \n Pour un new avec un reroll, il faut absolument mentionner le joueur du Reroll !! "}}
{{end}}